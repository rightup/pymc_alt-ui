(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{6296:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(78340).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},16950:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(78340).A)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},27529:(e,t,r)=>{"use strict";r.d(t,{A_:()=>u,Fz:()=>g,GT:()=>i,He:()=>y,Nw:()=>n,RC:()=>d,Ty:()=>h,V0:()=>l,VS:()=>x,ao:()=>o,f3:()=>m,iY:()=>p,w7:()=>f});let a=r(41463).env.NEXT_PUBLIC_API_URL||"";async function s(e,t){let r=`${a}${e}`,s={};if(t?.headers){let e=t.headers;e instanceof Headers?e.forEach((e,t)=>{s[t]=e}):Array.isArray(e)?e.forEach(([e,t])=>{s[e]=t}):Object.assign(s,e)}t?.body&&(s["Content-Type"]="application/json");let i=await fetch(r,{...t,headers:s});if(!i.ok)throw Error(`API error: ${i.status} ${i.statusText}`);return i.json()}async function i(){return s("/api/stats")}async function o(){return s("/api/logs")}async function l(e=100){return s(`/api/recent_packets?limit=${e}`)}async function c(e){let t=Math.max(e.limit||1e3,5e3),r=await l(t);if(!r.success||!r.data)return r;let a=r.data;return void 0!==e.type&&(a=a.filter(t=>(t.type??t.payload_type)===e.type)),void 0!==e.route&&(a=a.filter(t=>(t.route??t.route_type)===e.route)),e.start_timestamp&&(a=a.filter(t=>t.timestamp>=e.start_timestamp)),e.end_timestamp&&(a=a.filter(t=>t.timestamp<=e.end_timestamp)),e.limit&&a.length>e.limit&&(a=a.slice(0,e.limit)),{success:!0,data:a,count:a.length}}async function n(e=24){return s(`/api/packet_type_graph_data?hours=${e}`)}async function d(e=24){return s(`/api/noise_floor_history?hours=${e}`)}async function u(){return s("/api/hardware_stats")}async function m(){return s("/api/send_advert",{method:"POST",body:"{}"})}async function p(e){return s("/api/set_mode",{method:"POST",body:JSON.stringify({mode:e})})}async function h(e){return s("/api/set_duty_cycle",{method:"POST",body:JSON.stringify({enabled:e})})}async function g(e=20,t=20){try{let r=Math.floor(Date.now()/1e3),a=r-60*e,s=60*e/t,i=await c({start_timestamp:a,end_timestamp:r,limit:5e3});if(!i.success||!i.data)return{success:!1,error:i.error||"Failed to fetch packets"};let o=i.data,l=()=>{let e=[];for(let r=0;r<t;r++)e.push({bucket:r,start:a+r*s,end:a+(r+1)*s,count:0,avg_snr:0,avg_rssi:0});return e},n=l(),d=l(),u=l(),m=l(),p=n.map(()=>({snr:0,rssi:0,count:0}));for(let e of o){let r=Math.floor((e.timestamp-a)/s);if(r<0||r>=t)continue;let i=e.packet_origin;"tx_local"===i?d[r].count++:"tx_forward"===i||e.transmitted?u[r].count++:e.drop_reason&&m[r].count++,"tx_local"!==i&&(n[r].count++,p[r].snr+=e.snr||0,p[r].rssi+=e.rssi||0,p[r].count++)}for(let e=0;e<t;e++)p[e].count>0&&(n[e].avg_snr=p[e].snr/p[e].count,n[e].avg_rssi=p[e].rssi/p[e].count);return{success:!0,data:{time_range_minutes:e,bucket_count:t,bucket_duration_seconds:s,start_time:a,end_time:r,received:n,transmitted:d,forwarded:u,dropped:m}}}catch(e){return{success:!1,error:String(e)}}}async function f(e=24){try{let t=Math.floor(Date.now()/1e3),r=t-3600*e,[a,s]=await Promise.all([c({start_timestamp:r,end_timestamp:t,limit:5e4}),i()]);if(!a.success||!a.data)return{success:!1,error:a.error||"Failed to fetch packets"};let o=a.data,l=s.config?.radio?.spreading_factor||8,n=1e3*(s.config?.radio?.bandwidth||125),d=[];for(let t=0;t<e;t++)d.push({t:(r+3600*t)*1e3,tx_airtime_ms:0,rx_airtime_ms:0,tx_pkts:0,rx_pkts_ok:0,tx_util_pct:0,rx_util_decoded_pct:0,radio_activity_pct:0,avg_rx_airtime_ms_per_pkt:0,avg_tx_airtime_ms_per_pkt:0});for(let t of o){let a=Math.floor((t.timestamp-r)/3600);if(a<0||a>=e)continue;let s=t.length||t.payload_length||32,i=function(e,t=8,r=125e3){let a=Math.pow(2,t)/(r/1e3);return 8*a+(e+4.25)*8*a}(s,l,n),o=t.packet_origin;"tx_local"===o||"tx_forward"===o||t.transmitted?(d[a].tx_airtime_ms+=i,d[a].tx_pkts++):(d[a].rx_airtime_ms+=i,d[a].rx_pkts_ok++)}for(let e of d)e.tx_util_pct=e.tx_airtime_ms/36e5*100,e.rx_util_decoded_pct=e.rx_airtime_ms/36e5*100,e.radio_activity_pct=(e.tx_airtime_ms+e.rx_airtime_ms)/36e5*100,e.rx_pkts_ok>0&&(e.avg_rx_airtime_ms_per_pkt=e.rx_airtime_ms/e.rx_pkts_ok),e.tx_pkts>0&&(e.avg_tx_airtime_ms_per_pkt=e.tx_airtime_ms/e.tx_pkts);return{success:!0,data:{bins:d,bin_duration_seconds:3600,hours:e,anomaly_counters:{missing_airtime_ms:0,outlier_bins:0}}}}catch(e){return{success:!1,error:String(e)}}}async function x(e){return s("/api/update_radio_config",{method:"POST",body:JSON.stringify(e)})}async function y(e){return s("/api/set_log_level",{method:"POST",body:JSON.stringify({level:e})})}},29e3:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>_});var a=r(95155),s=r(12115),i=r(83278),o=r(57060),l=r(78340);let c=(0,l.A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var n=r(6296);let d=(0,l.A)("bug",[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]]);var u=r(48368),m=r(16950),p=r(91958),h=r(29722),g=r(48884),f=r(27529);let x=(0,s.memo)(function({log:e}){let t=(0,g.Eo)(e.level);return(0,a.jsx)("div",{className:(0,h.A)("p-3 rounded-lg border bg-bg-subtle",t),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:(0,h.A)("px-2 py-0.5 rounded text-xs font-medium border shrink-0",t),children:e.level}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-text-secondary break-words whitespace-pre-wrap",children:e.message}),(0,a.jsx)("p",{className:"text-xs text-text-muted mt-1",children:new Date(e.timestamp).toLocaleString()})]})]})})});function y(){let e=(0,i.jg)(),[t,r]=(0,s.useState)("INFO"),[o,l]=(0,s.useState)(!1),[u,m]=(0,s.useState)(null);(0,s.useEffect)(()=>{e.length>0&&r(e.some(e=>"DEBUG"===e.level)?"DEBUG":"INFO")},[e]);let p=(0,s.useCallback)(async e=>{if(console.log("handleToggle called:",{newLevel:e,selectedLevel:t,isChanging:o}),e===t||o)return void console.log("Early return - same level or changing");console.log("Making API call..."),l(!0),m(null);try{let t=await (0,f.He)(e);t.success&&t.data?(r(e),m(t.data.message),setTimeout(()=>m(null),5e3)):(m(t.error||"Failed to change log level"),setTimeout(()=>m(null),3e3))}catch{m("Failed to change log level"),setTimeout(()=>m(null),3e3)}finally{l(!1)}},[t,o]);return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[u&&(0,a.jsx)("span",{className:"text-xs text-text-muted animate-pulse",children:u}),(0,a.jsxs)("div",{className:"flex rounded-lg border border-border-subtle overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>p("INFO"),disabled:o,className:(0,h.A)("px-3 py-1.5 sm:px-4 sm:py-2 text-sm font-medium flex items-center gap-2 transition-colors","INFO"===t?"bg-accent-primary/20 text-accent-primary border-accent-primary/30":"bg-bg-subtle text-text-muted hover:bg-bg-elevated",o&&"opacity-50 cursor-not-allowed"),children:[(0,a.jsx)(c,{className:"w-4 h-4"}),"INFO"]}),(0,a.jsxs)("button",{onClick:()=>p("DEBUG"),disabled:o,className:(0,h.A)("px-3 py-1.5 sm:px-4 sm:py-2 text-sm font-medium flex items-center gap-2 transition-colors border-l border-border-subtle","DEBUG"===t?"bg-amber-500/20 text-amber-400 border-amber-500/30":"bg-bg-subtle text-text-muted hover:bg-bg-elevated",o&&"opacity-50 cursor-not-allowed"),children:[o?(0,a.jsx)(n.A,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(d,{className:"w-4 h-4"}),"DEBUG"]})]})]})}function _(){let e=(0,i.jg)(),t=(0,i.fL)(),r=(0,i.XL)(),s=(0,i.p5)(),l=(0,i.Ni)();return(0,o.n)(s,g.v5.logs,r),(0,a.jsxs)("div",{className:"section-gap",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("h1",{className:"type-title text-text-primary flex items-center gap-3",children:[(0,a.jsx)(u.A,{className:"w-6 h-6 text-accent-primary flex-shrink-0"}),"System Logs"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4",children:[(0,a.jsx)(y,{}),r&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(m.A,{className:"w-2 h-2 fill-accent-success text-accent-success animate-pulse"}),(0,a.jsx)("span",{className:"text-text-muted",children:"Live"})]}),(0,a.jsxs)("button",{onClick:()=>l(!r),className:(0,h.A)("px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg text-sm font-medium transition-colors","flex items-center gap-2 border",r?"bg-accent-success/20 text-accent-success border-accent-success/30":"bg-bg-subtle text-text-muted border-border-subtle hover:bg-bg-elevated"),children:[(0,a.jsx)(p.A,{className:(0,h.A)("w-4 h-4",r&&"animate-spin")}),(0,a.jsx)("span",{className:"hidden xs:inline",children:r?"Live":"Paused"})]})]})]}),(0,a.jsx)("div",{className:"glass-card p-4",children:(0,a.jsx)("div",{className:"space-y-2 max-h-[calc(100vh-250px)] overflow-y-auto font-mono text-sm",children:t&&0===e.length?(0,a.jsx)("div",{className:"text-center py-12 text-text-muted",children:"Loading logs..."}):0===e.length?(0,a.jsx)("div",{className:"text-center py-12 text-text-muted",children:"No logs available"}):e.map((e,t)=>(0,a.jsx)(x,{log:e},`${e.timestamp}-${t}`))})})]})}},29722:(e,t,r)=>{"use strict";function a(){for(var e,t,r=0,a="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=function e(t){var r,a,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t)if(Array.isArray(t)){var i=t.length;for(r=0;r<i;r++)t[r]&&(a=e(t[r]))&&(s&&(s+=" "),s+=a)}else for(a in t)t[a]&&(s&&(s+=" "),s+=a);return s}(e))&&(a&&(a+=" "),a+=t);return a}r.d(t,{$:()=>a,A:()=>s});let s=a},48368:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(78340).A)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},48884:(e,t,r)=>{"use strict";r.d(t,{CM:()=>a,Eo:()=>d,IA:()=>i,JW:()=>s,v5:()=>c,xt:()=>l});let a=[{label:"20m",minutes:20,buckets:40},{label:"1h",minutes:60,buckets:60},{label:"3h",minutes:180,buckets:90},{label:"12h",minutes:720,buckets:72},{label:"24h",minutes:1440,buckets:96},{label:"3d",minutes:4320,buckets:72},{label:"7d",minutes:10080,buckets:84}],s=[{label:"1h",hours:1},{label:"3h",hours:3},{label:"12h",hours:12},{label:"24h",hours:24},{label:"3d",hours:72},{label:"7d",hours:168}],i={received:"#39D98A",forwarded:"#60A5FA",transmitted:"#F9D26F",dropped:"#FF5C7A",neutral:"#B0B0C3"},o={advert:"ADVERT",grp_txt:"GRP_TXT",txt_msg:"TXT_MSG",response:"RESPONSE",anon_req:"ANON_REQ",path:"PATH",req:"REQ",ack:"ACK"};function l(e){return o[e.toLowerCase()]||e.toUpperCase().slice(0,8)}let c={stats:3e3,packets:3e3,charts:3e4,logs:2e3,system:3e3},n={DEBUG:"text-[var(--log-debug)] border-[var(--log-debug)]/30",INFO:"text-[var(--log-info)] border-[var(--log-info)]/30",WARNING:"text-[var(--log-warning)] border-[var(--log-warning)]/30",ERROR:"text-[var(--log-error)] border-[var(--log-error)]/30",CRITICAL:"text-[var(--log-critical)] border-[var(--log-critical)]/50 bg-[var(--log-critical)]/10"};function d(e){return n[e]||"text-text-muted border-border-subtle"}},57060:(e,t,r)=>{"use strict";r.d(t,{n:()=>s});var a=r(12115);function s(e,t,r=!0,i=!1){let o=(0,a.useRef)(e);(0,a.useEffect)(()=>{o.current=e},[e]),(0,a.useEffect)(()=>{if(!r)return;i||o.current();let e=setInterval(()=>{o.current()},t);return()=>clearInterval(e)},[t,r,i])}},78340:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(12115);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},i=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:l="",children:c,iconNode:n,...d},u)=>(0,a.createElement)("svg",{ref:u,...o,width:t,height:t,stroke:e,strokeWidth:s?24*Number(r)/Number(t):r,className:i("lucide",l),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"},...d},[...n.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(c)?c:[c]])),c=(e,t)=>{let r=(0,a.forwardRef)(({className:r,...o},c)=>(0,a.createElement)(l,{ref:c,iconNode:t,className:i(`lucide-${s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...o}));return r.displayName=s(e),r}},83278:(e,t,r)=>{"use strict";let a;r.d(t,{fs:()=>A,p5:()=>k,xe:()=>v,Sg:()=>b,rf:()=>_,XL:()=>y,jg:()=>f,fL:()=>x,Xb:()=>h,T:()=>g,Kk:()=>N,Ni:()=>w,J3:()=>m,B7:()=>p,Pj:()=>u});var s=r(12115);let i=e=>{let t,r=new Set,a=(e,a)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=a?a:"object"!=typeof s||null===s)?s:Object.assign({},t,s),r.forEach(r=>r(t,e))}},s=()=>t,i={setState:a,getState:s,getInitialState:()=>o,subscribe:e=>(r.add(e),()=>r.delete(e))},o=t=e(a,s,i);return i},o=e=>{let t=e?i(e):i,r=e=>(function(e,t=e=>e){let r=s.useSyncExternalStore(e.subscribe,s.useCallback(()=>t(e.getState()),[e,t]),s.useCallback(()=>t(e.getInitialState()),[e,t]));return s.useDebugValue(r),r})(t,e);return Object.assign(r,t),r};var l=r(27529);let c="pymc-resource-history",n="pymc-resource-last-fetch",d=(a=(e,t)=>({stats:null,statsLoading:!1,statsError:null,packets:[],packetsLoading:!1,packetsError:null,lastPacketTimestamp:0,logs:[],logsLoading:!1,liveMode:!0,flashReceived:0,flashAdvert:0,resourceHistory:function(){try{let e=localStorage.getItem(c);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load resource history from localStorage:",e)}return[]}(),lastResourceFetch:function(){try{let e=localStorage.getItem(n);if(e)return parseInt(e,10)||0}catch(e){}return 0}(),fetchStats:async()=>{e({statsLoading:!0,statsError:null});try{let t=await l.GT();e({stats:t,statsLoading:!1})}catch(t){e({statsError:t instanceof Error?t.message:"Failed to fetch stats",statsLoading:!1})}},fetchPackets:async(r=50)=>{e({packetsLoading:!0,packetsError:null});try{let a=await l.V0(r);if(a.success&&a.data){let r=a.data,{lastPacketTimestamp:s}=t(),i=r.length>0?Math.max(...r.map(e=>e.timestamp??0)):0;i>s&&s>0&&e({flashReceived:t().flashReceived+1}),e({packets:r,packetsLoading:!1,lastPacketTimestamp:i||s})}else e({packetsError:a.error||"Failed to fetch packets",packetsLoading:!1})}catch(t){e({packetsError:t instanceof Error?t.message:"Failed to fetch packets",packetsLoading:!1})}},fetchLogs:async()=>{e({logsLoading:!0});try{let t=await l.ao();e({logs:t.logs,logsLoading:!1})}catch(t){e({logsLoading:!1})}},setLiveMode:t=>{e({liveMode:t})},setMode:async e=>{try{(await l.iY(e)).success&&await t().fetchStats()}catch(e){console.error("Failed to set mode:",e)}},setDutyCycle:async e=>{try{(await l.Ty(e)).success&&t().fetchStats()}catch(e){console.error("Failed to set duty cycle:",e)}},sendAdvert:async()=>{try{let r=await l.f3();return r.success&&e({flashAdvert:t().flashAdvert+1}),r.success}catch(e){return console.error("Failed to send advert:",e),!1}},triggerFlashReceived:()=>{e({flashReceived:t().flashReceived+1})},triggerFlashAdvert:()=>{e({flashAdvert:t().flashAdvert+1})},addResourceDataPoint:(r,a,s)=>{let i=Date.now(),{lastResourceFetch:o,resourceHistory:l}=t();if(i-o<1e3)return void console.log("[Store] Skipping duplicate (too fast)");let d=new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),u=[...l,{timestamp:i,time:d,cpu:r,memory:a}],m=u.length>s?u.slice(-s):u;console.log("[Store] Adding resource point, new length:",m.length),e({resourceHistory:m,lastResourceFetch:i});try{localStorage.setItem(c,JSON.stringify(m)),localStorage.setItem(n,i.toString())}catch(e){console.warn("Failed to save resource history to localStorage:",e)}}}))?o(a):o,u=d,m=()=>d(e=>e.stats),p=()=>d(e=>e.statsError),h=()=>d(e=>e.packets),g=()=>d(e=>e.packetsLoading),f=()=>d(e=>e.logs),x=()=>d(e=>e.logsLoading),y=()=>d(e=>e.liveMode),_=()=>d(e=>e.flashReceived),b=()=>d(e=>e.flashAdvert),v=()=>d(e=>e.fetchPackets),k=()=>d(e=>e.fetchLogs),w=()=>d(e=>e.setLiveMode),N=()=>d(e=>e.resourceHistory),A=()=>d(e=>e.addResourceDataPoint)},91958:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(78340).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},93556:(e,t,r)=>{Promise.resolve().then(r.bind(r,29e3))}},e=>{_N_E=e(e.s=93556)}]);