(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{13364:(e,t,r)=>{"use strict";function s(e){if(e<60)return`${Math.floor(e)}s`;let t=Math.floor(e/86400),r=Math.floor(e%86400/3600),s=Math.floor(e%3600/60),a=[];return t>0&&a.push(`${t}d`),r>0&&a.push(`${r}h`),(s>0||0===a.length)&&a.push(`${s}m`),a.join(" ")}function a(e){let t=Date.now()/1e3-e;return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}function i(e){return new Date(1e3*e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}function n(e){return new Date(1e3*e).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}function o(e){return`${(e/1e6).toFixed(3)} MHz`}function l(e){return`${(e/1e3).toFixed(1)} kHz`}r.d(t,{$o:()=>l,QR:()=>o,Y0:()=>s,fU:()=>n,fw:()=>a,r6:()=>i})},16950:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(78340).A)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},27529:(e,t,r)=>{"use strict";r.d(t,{A_:()=>u,Fz:()=>h,GT:()=>i,He:()=>g,Nw:()=>c,RC:()=>d,Ty:()=>m,V0:()=>o,VS:()=>y,ao:()=>n,f3:()=>p,iY:()=>x,w7:()=>f});let s=r(41463).env.NEXT_PUBLIC_API_URL||"";async function a(e,t){let r=`${s}${e}`,a={};if(t?.headers){let e=t.headers;e instanceof Headers?e.forEach((e,t)=>{a[t]=e}):Array.isArray(e)?e.forEach(([e,t])=>{a[e]=t}):Object.assign(a,e)}t?.body&&(a["Content-Type"]="application/json");let i=await fetch(r,{...t,headers:a});if(!i.ok)throw Error(`API error: ${i.status} ${i.statusText}`);return i.json()}async function i(){return a("/api/stats")}async function n(){return a("/api/logs")}async function o(e=100){return a(`/api/recent_packets?limit=${e}`)}async function l(e){let t=Math.max(e.limit||1e3,5e3),r=await o(t);if(!r.success||!r.data)return r;let s=r.data;return void 0!==e.type&&(s=s.filter(t=>(t.type??t.payload_type)===e.type)),void 0!==e.route&&(s=s.filter(t=>(t.route??t.route_type)===e.route)),e.start_timestamp&&(s=s.filter(t=>t.timestamp>=e.start_timestamp)),e.end_timestamp&&(s=s.filter(t=>t.timestamp<=e.end_timestamp)),e.limit&&s.length>e.limit&&(s=s.slice(0,e.limit)),{success:!0,data:s,count:s.length}}async function c(e=24){return a(`/api/packet_type_graph_data?hours=${e}`)}async function d(e=24){return a(`/api/noise_floor_history?hours=${e}`)}async function u(){return a("/api/hardware_stats")}async function p(){return a("/api/send_advert",{method:"POST",body:"{}"})}async function x(e){return a("/api/set_mode",{method:"POST",body:JSON.stringify({mode:e})})}async function m(e){return a("/api/set_duty_cycle",{method:"POST",body:JSON.stringify({enabled:e})})}async function h(e=20,t=20){try{let r=Math.floor(Date.now()/1e3),s=r-60*e,a=60*e/t,i=await l({start_timestamp:s,end_timestamp:r,limit:5e3});if(!i.success||!i.data)return{success:!1,error:i.error||"Failed to fetch packets"};let n=i.data,o=()=>{let e=[];for(let r=0;r<t;r++)e.push({bucket:r,start:s+r*a,end:s+(r+1)*a,count:0,avg_snr:0,avg_rssi:0});return e},c=o(),d=o(),u=o(),p=o(),x=c.map(()=>({snr:0,rssi:0,count:0}));for(let e of n){let r=Math.floor((e.timestamp-s)/a);if(r<0||r>=t)continue;let i=e.packet_origin;"tx_local"===i?d[r].count++:"tx_forward"===i||e.transmitted?u[r].count++:e.drop_reason&&p[r].count++,"tx_local"!==i&&(c[r].count++,x[r].snr+=e.snr||0,x[r].rssi+=e.rssi||0,x[r].count++)}for(let e=0;e<t;e++)x[e].count>0&&(c[e].avg_snr=x[e].snr/x[e].count,c[e].avg_rssi=x[e].rssi/x[e].count);return{success:!0,data:{time_range_minutes:e,bucket_count:t,bucket_duration_seconds:a,start_time:s,end_time:r,received:c,transmitted:d,forwarded:u,dropped:p}}}catch(e){return{success:!1,error:String(e)}}}async function f(e=24){try{let t=Math.floor(Date.now()/1e3),r=t-3600*e,[s,a]=await Promise.all([l({start_timestamp:r,end_timestamp:t,limit:5e4}),i()]);if(!s.success||!s.data)return{success:!1,error:s.error||"Failed to fetch packets"};let n=s.data,o=a.config?.radio?.spreading_factor||8,c=1e3*(a.config?.radio?.bandwidth||125),d=[];for(let t=0;t<e;t++)d.push({t:(r+3600*t)*1e3,tx_airtime_ms:0,rx_airtime_ms:0,tx_pkts:0,rx_pkts_ok:0,tx_util_pct:0,rx_util_decoded_pct:0,radio_activity_pct:0,avg_rx_airtime_ms_per_pkt:0,avg_tx_airtime_ms_per_pkt:0});for(let t of n){let s=Math.floor((t.timestamp-r)/3600);if(s<0||s>=e)continue;let a=t.length||t.payload_length||32,i=function(e,t=8,r=125e3){let s=Math.pow(2,t)/(r/1e3);return 8*s+(e+4.25)*8*s}(a,o,c),n=t.packet_origin;"tx_local"===n||"tx_forward"===n||t.transmitted?(d[s].tx_airtime_ms+=i,d[s].tx_pkts++):(d[s].rx_airtime_ms+=i,d[s].rx_pkts_ok++)}for(let e of d)e.tx_util_pct=e.tx_airtime_ms/36e5*100,e.rx_util_decoded_pct=e.rx_airtime_ms/36e5*100,e.radio_activity_pct=(e.tx_airtime_ms+e.rx_airtime_ms)/36e5*100,e.rx_pkts_ok>0&&(e.avg_rx_airtime_ms_per_pkt=e.rx_airtime_ms/e.rx_pkts_ok),e.tx_pkts>0&&(e.avg_tx_airtime_ms_per_pkt=e.tx_airtime_ms/e.tx_pkts);return{success:!0,data:{bins:d,bin_duration_seconds:3600,hours:e,anomaly_counters:{missing_airtime_ms:0,outlier_bins:0}}}}catch(e){return{success:!1,error:String(e)}}}async function y(e){return a("/api/update_radio_config",{method:"POST",body:JSON.stringify(e)})}async function g(e){return a("/api/set_log_level",{method:"POST",body:JSON.stringify({level:e})})}},28947:(e,t,r)=>{"use strict";r.d(t,{$K:()=>i,Fl:()=>o,ir:()=>n,wv:()=>a,zz:()=>l});var s=r(62507);function a(e){return null==e?"UNKNOWN":s.x[e]||`TYPE_${e}`}function i(e){return null==e?"UNKNOWN":s.C[e]||`ROUTE_${e}`}function n(e){return({ADVERT:"text-[var(--pkt-advert)]",FLOOD:"text-[var(--pkt-flood)]",TXT_MSG:"text-[var(--pkt-txt-msg)]",ACK:"text-[var(--pkt-ack)]",TRACE:"text-[var(--pkt-trace)]",REQ:"text-[var(--pkt-req)]",RESPONSE:"text-[var(--pkt-response)]",GRP_TXT:"text-[var(--pkt-grp-txt)]",GRP_DATA:"text-[var(--pkt-grp-data)]",PATH:"text-[var(--pkt-path)]",ANON_REQ:"text-[var(--pkt-anon)]"})[e]||"text-[var(--pkt-unknown)]"}function o(e){return({FLOOD:"bg-[var(--route-flood)]/20 text-[var(--route-flood)] border-[var(--route-flood)]/30",DIRECT:"bg-[var(--route-direct)]/20 text-[var(--route-direct)] border-[var(--route-direct)]/30",TRANSPORT:"bg-[var(--route-transport)]/20 text-[var(--route-transport)] border-[var(--route-transport)]/30",T_FLOOD:"bg-[var(--route-flood)]/20 text-[var(--route-flood)] border-[var(--route-flood)]/30",T_DIRECT:"bg-[var(--route-direct)]/20 text-[var(--route-direct)] border-[var(--route-direct)]/30"})[e]||"bg-bg-subtle text-text-muted border-border-subtle"}function l(e){return 1===e||!0===e}},29722:(e,t,r)=>{"use strict";function s(){for(var e,t,r=0,s="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=function e(t){var r,s,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t)if(Array.isArray(t)){var i=t.length;for(r=0;r<i;r++)t[r]&&(s=e(t[r]))&&(a&&(a+=" "),a+=s)}else for(s in t)t[s]&&(a&&(a+=" "),a+=s);return a}(e))&&(s&&(s+=" "),s+=t);return s}r.d(t,{$:()=>s,A:()=>a});let a=s},33210:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(78340).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},46029:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(78340).A)("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},48884:(e,t,r)=>{"use strict";r.d(t,{CM:()=>s,Eo:()=>d,IA:()=>i,JW:()=>a,v5:()=>l,xt:()=>o});let s=[{label:"20m",minutes:20,buckets:40},{label:"1h",minutes:60,buckets:60},{label:"3h",minutes:180,buckets:90},{label:"12h",minutes:720,buckets:72},{label:"24h",minutes:1440,buckets:96},{label:"3d",minutes:4320,buckets:72},{label:"7d",minutes:10080,buckets:84}],a=[{label:"1h",hours:1},{label:"3h",hours:3},{label:"12h",hours:12},{label:"24h",hours:24},{label:"3d",hours:72},{label:"7d",hours:168}],i={received:"#39D98A",forwarded:"#60A5FA",transmitted:"#F9D26F",dropped:"#FF5C7A",neutral:"#B0B0C3"},n={advert:"ADVERT",grp_txt:"GRP_TXT",txt_msg:"TXT_MSG",response:"RESPONSE",anon_req:"ANON_REQ",path:"PATH",req:"REQ",ack:"ACK"};function o(e){return n[e.toLowerCase()]||e.toUpperCase().slice(0,8)}let l={stats:3e3,packets:3e3,charts:3e4,logs:2e3,system:3e3},c={DEBUG:"text-[var(--log-debug)] border-[var(--log-debug)]/30",INFO:"text-[var(--log-info)] border-[var(--log-info)]/30",WARNING:"text-[var(--log-warning)] border-[var(--log-warning)]/30",ERROR:"text-[var(--log-error)] border-[var(--log-error)]/30",CRITICAL:"text-[var(--log-critical)] border-[var(--log-critical)]/50 bg-[var(--log-critical)]/10"};function d(e){return c[e]||"text-text-muted border-border-subtle"}},56181:(e,t,r)=>{Promise.resolve().then(r.bind(r,87580))},57060:(e,t,r)=>{"use strict";r.d(t,{n:()=>a});var s=r(12115);function a(e,t,r=!0,i=!1){let n=(0,s.useRef)(e);(0,s.useEffect)(()=>{n.current=e},[e]),(0,s.useEffect)(()=>{if(!r)return;i||n.current();let e=setInterval(()=>{n.current()},t);return()=>clearInterval(e)},[t,r,i])}},62507:(e,t,r)=>{"use strict";r.d(t,{C:()=>a,x:()=>s});let s={0:"REQ",1:"RESPONSE",2:"TXT_MSG",3:"ACK",4:"ADVERT",5:"GRP_TXT",6:"GRP_DATA",7:"ANON_REQ",8:"PATH",9:"TRACE",10:"RAW_CUSTOM"},a={0:"UNKNOWN",1:"DIRECT",2:"FLOOD",3:"TRANSPORT",4:"T_FLOOD",5:"T_DIRECT"}},64964:(e,t,r)=>{"use strict";r.d(t,{Q:()=>l});var s=r(95155),a=r(12115),i=r(94514);let n=(0,r(78340).A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var o=r(29722);function l({hash:e,prefixLength:t=8,suffixLength:r=6,full:l=!1,className:c,size:d="md"}){let[u,p]=(0,a.useState)(!1),[x,m]=(0,a.useState)(!1),h=(0,a.useRef)(null),f=(0,a.useCallback)(t=>{t.preventDefault(),t.stopPropagation(),h.current&&clearTimeout(h.current);let r=function(e){if((window.isSecureContext||"https:"===window.location.protocol||"localhost"===window.location.hostname)&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)return navigator.clipboard.writeText(e).catch(()=>{}),!0;try{let t=window.scrollX,r=window.scrollY,s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.left="-9999px",s.style.top="-9999px",s.style.opacity="0",s.style.pointerEvents="none",s.setAttribute("readonly",""),document.body.appendChild(s),s.focus({preventScroll:!0}),s.select(),s.setSelectionRange(0,e.length);let a=document.execCommand("copy");return document.body.removeChild(s),window.scrollTo(t,r),a}catch(e){return console.error("Copy failed:",e),!1}}(e);p(!0),h.current=setTimeout(()=>p(!1),2e3),r||console.warn("Copy may have failed for:",e.slice(0,16)+"...")},[e]),y=l||e.length<=t+r+3?e:`${e.slice(0,t)}…${e.slice(-r)}`;return(0,s.jsxs)("button",{type:"button",onClick:f,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),className:(0,o.A)("inline-flex items-center font-mono rounded-md transition-all duration-200","bg-bg-subtle/80 hover:bg-bg-elevated border border-border-subtle hover:border-border-strong","cursor-pointer select-none","sm"===d?"text-[10px] px-1.5 py-0.5 gap-1":"text-xs px-2 py-1 gap-1.5",c),title:`Click to copy: ${e}`,"aria-label":`Copy hash ${e}`,children:[(0,s.jsx)("span",{className:(0,o.A)("transition-colors duration-200",u?"text-accent-success":"text-text-secondary"),children:y}),(0,s.jsx)("span",{className:(0,o.A)("flex items-center justify-center transition-all duration-200","sm"===d?"w-3 h-3":"w-3.5 h-3.5"),children:u?(0,s.jsx)(i.A,{className:(0,o.A)("text-accent-success","sm"===d?"w-2.5 h-2.5":"w-3 h-3")}):(0,s.jsx)(n,{className:(0,o.A)("transition-opacity duration-200",x?"opacity-70":"opacity-40","sm"===d?"w-2.5 h-2.5":"w-3 h-3")})})]})}},78340:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(12115);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},i=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,s.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:o="",children:l,iconNode:c,...d},u)=>(0,s.createElement)("svg",{ref:u,...n,width:t,height:t,stroke:e,strokeWidth:a?24*Number(r)/Number(t):r,className:i("lucide",o),...!l&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(l)?l:[l]])),l=(e,t)=>{let r=(0,s.forwardRef)(({className:r,...n},l)=>(0,s.createElement)(o,{ref:l,iconNode:t,className:i(`lucide-${a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...n}));return r.displayName=a(e),r}},83278:(e,t,r)=>{"use strict";let s;r.d(t,{fs:()=>w,p5:()=>k,xe:()=>v,Sg:()=>_,rf:()=>b,XL:()=>g,jg:()=>f,fL:()=>y,Xb:()=>m,T:()=>h,Kk:()=>N,Ni:()=>j,J3:()=>p,B7:()=>x,Pj:()=>u});var a=r(12115);let i=e=>{let t,r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,i={setState:s,getState:a,getInitialState:()=>n,subscribe:e=>(r.add(e),()=>r.delete(e))},n=t=e(s,a,i);return i},n=e=>{let t=e?i(e):i,r=e=>(function(e,t=e=>e){let r=a.useSyncExternalStore(e.subscribe,a.useCallback(()=>t(e.getState()),[e,t]),a.useCallback(()=>t(e.getInitialState()),[e,t]));return a.useDebugValue(r),r})(t,e);return Object.assign(r,t),r};var o=r(27529);let l="pymc-resource-history",c="pymc-resource-last-fetch",d=(s=(e,t)=>({stats:null,statsLoading:!1,statsError:null,packets:[],packetsLoading:!1,packetsError:null,lastPacketTimestamp:0,logs:[],logsLoading:!1,liveMode:!0,flashReceived:0,flashAdvert:0,resourceHistory:function(){try{let e=localStorage.getItem(l);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load resource history from localStorage:",e)}return[]}(),lastResourceFetch:function(){try{let e=localStorage.getItem(c);if(e)return parseInt(e,10)||0}catch(e){}return 0}(),fetchStats:async()=>{e({statsLoading:!0,statsError:null});try{let t=await o.GT();e({stats:t,statsLoading:!1})}catch(t){e({statsError:t instanceof Error?t.message:"Failed to fetch stats",statsLoading:!1})}},fetchPackets:async(r=50)=>{e({packetsLoading:!0,packetsError:null});try{let s=await o.V0(r);if(s.success&&s.data){let r=s.data,{lastPacketTimestamp:a}=t(),i=r.length>0?Math.max(...r.map(e=>e.timestamp??0)):0;i>a&&a>0&&e({flashReceived:t().flashReceived+1}),e({packets:r,packetsLoading:!1,lastPacketTimestamp:i||a})}else e({packetsError:s.error||"Failed to fetch packets",packetsLoading:!1})}catch(t){e({packetsError:t instanceof Error?t.message:"Failed to fetch packets",packetsLoading:!1})}},fetchLogs:async()=>{e({logsLoading:!0});try{let t=await o.ao();e({logs:t.logs,logsLoading:!1})}catch(t){e({logsLoading:!1})}},setLiveMode:t=>{e({liveMode:t})},setMode:async e=>{try{(await o.iY(e)).success&&await t().fetchStats()}catch(e){console.error("Failed to set mode:",e)}},setDutyCycle:async e=>{try{(await o.Ty(e)).success&&t().fetchStats()}catch(e){console.error("Failed to set duty cycle:",e)}},sendAdvert:async()=>{try{let r=await o.f3();return r.success&&e({flashAdvert:t().flashAdvert+1}),r.success}catch(e){return console.error("Failed to send advert:",e),!1}},triggerFlashReceived:()=>{e({flashReceived:t().flashReceived+1})},triggerFlashAdvert:()=>{e({flashAdvert:t().flashAdvert+1})},addResourceDataPoint:(r,s,a)=>{let i=Date.now(),{lastResourceFetch:n,resourceHistory:o}=t();if(i-n<1e3)return;let d=new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),u=[...o,{timestamp:i,time:d,cpu:r,memory:s}],p=u.length>a?u.slice(-a):u;e({resourceHistory:p,lastResourceFetch:i});try{localStorage.setItem(l,JSON.stringify(p)),localStorage.setItem(c,i.toString())}catch(e){console.warn("Failed to save resource history to localStorage:",e)}}}))?n(s):n,u=d,p=()=>d(e=>e.stats),x=()=>d(e=>e.statsError),m=()=>d(e=>e.packets),h=()=>d(e=>e.packetsLoading),f=()=>d(e=>e.logs),y=()=>d(e=>e.logsLoading),g=()=>d(e=>e.liveMode),b=()=>d(e=>e.flashReceived),_=()=>d(e=>e.flashAdvert),v=()=>d(e=>e.fetchPackets),k=()=>d(e=>e.fetchLogs),j=()=>d(e=>e.setLiveMode),N=()=>d(e=>e.resourceHistory),w=()=>d(e=>e.addResourceDataPoint)},87580:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var s=r(95155),a=r(12115),i=r(46029),n=r(16950),o=r(91958);let l=(0,r(78340).A)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var c=r(33210),d=r(29722),u=r(27529),p=r(62507),x=r(57060),m=r(48884),h=r(28947),f=r(83278),y=r(13364);function g({packet:e}){return(0,h.zz)(e.transmitted)?(0,s.jsx)("span",{className:"text-xs text-accent-success",children:"✓ TX"}):(0,h.zz)(e.is_duplicate)?(0,s.jsx)("span",{className:"text-xs text-text-muted",children:"Duplicate"}):"No transport keys configured"===e.drop_reason?(0,s.jsx)("span",{className:"text-xs text-accent-secondary",children:"Monitor Only"}):e.drop_reason?(0,s.jsx)("span",{className:"text-xs text-accent-danger",children:e.drop_reason}):(0,s.jsx)("span",{className:"text-xs text-text-muted",children:"RX"})}let b=(0,a.memo)(function({packet:e,index:t,onClick:r,isFlashing:a=!1}){let i=e.payload_type_name||(0,h.wv)(e.payload_type??e.type),n=e.route_type_name||(0,h.$K)(e.route_type??e.route),o=e.payload_length??e.length??0,l=e.snr??0;return(0,s.jsxs)("tr",{onClick:()=>r(e),className:(0,d.A)("cursor-pointer transition-colors duration-150","hover:bg-bg-subtle",(0,h.zz)(e.transmitted)&&"bg-accent-success/5",(0,h.zz)(e.is_duplicate)&&"opacity-50",a&&"flash-row"),children:[(0,s.jsx)("td",{className:"py-3 px-4 text-sm font-mono text-text-secondary",children:(0,y.r6)(e.timestamp)}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("span",{className:(0,d.A)("text-sm font-medium",(0,h.ir)(i)),children:i})}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("span",{className:(0,d.A)("px-2 py-0.5 rounded text-xs border",(0,h.Fl)(n)),children:n})}),(0,s.jsxs)("td",{className:"py-3 px-4 text-sm text-text-secondary",children:[e.rssi," dBm"]}),(0,s.jsxs)("td",{className:"py-3 px-4 text-sm text-text-secondary",children:[l.toFixed(1)," dB"]}),(0,s.jsxs)("td",{className:"py-3 px-4 text-sm text-text-secondary",children:[o,"B"]}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)(g,{packet:e})})]})});var _=r(64964);function v({label:e,children:t}){return(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("span",{className:"text-text-muted",children:[e,":"]}),(0,s.jsx)("span",{className:"text-text-primary",children:t})]})}let k=(0,a.memo)(function({packet:e,onClose:t}){let r=e.payload_type_name||(0,h.wv)(e.payload_type??e.type),a=e.route_type_name||(0,h.$K)(e.route_type??e.route),i=e.payload_length??e.length??0,n=e.snr??0,o=e.tx_delay_ms??0,l="Received",d="text-text-primary";return(0,h.zz)(e.transmitted)?(l="Transmitted",d="text-accent-success"):(0,h.zz)(e.is_duplicate)?(l="Duplicate",d="text-text-muted"):"No transport keys configured"===e.drop_reason?(l="Monitor Only",d="text-accent-secondary"):e.drop_reason&&(l=e.drop_reason,d="text-accent-danger"),(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:t,children:(0,s.jsxs)("div",{className:"glass-card max-w-lg w-full p-6",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-text-primary",children:"Packet Details"}),(0,s.jsx)("button",{onClick:t,className:"text-text-muted hover:text-text-primary",children:(0,s.jsx)(c.A,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,s.jsx)(v,{label:"Hash",children:(0,s.jsx)(_.Q,{hash:e.packet_hash,size:"sm"})}),(0,s.jsx)(v,{label:"Timestamp",children:(0,y.r6)(e.timestamp)}),(0,s.jsx)(v,{label:"Type",children:(0,s.jsx)("span",{className:(0,h.ir)(r),children:r})}),(0,s.jsx)(v,{label:"Route",children:a}),(0,s.jsxs)(v,{label:"RSSI",children:[e.rssi," dBm"]}),(0,s.jsxs)(v,{label:"SNR",children:[n.toFixed(2)," dB"]}),e.src_hash&&(0,s.jsx)(v,{label:"Source",children:(0,s.jsx)(_.Q,{hash:e.src_hash,size:"sm"})}),e.dst_hash&&(0,s.jsx)(v,{label:"Destination",children:(0,s.jsx)(_.Q,{hash:e.dst_hash,size:"sm"})}),e.path_hash&&(0,s.jsx)(v,{label:"Path",children:(0,s.jsx)(_.Q,{hash:e.path_hash,size:"sm"})}),(0,s.jsxs)(v,{label:"Payload Length",children:[i," bytes"]}),void 0!==e.score&&(0,s.jsx)(v,{label:"Score",children:e.score.toFixed(3)}),(0,s.jsxs)(v,{label:"TX Delay",children:[o.toFixed(1)," ms"]}),(0,s.jsx)(v,{label:"Status",children:(0,s.jsx)("span",{className:d,children:l})})]})]})})});function j(){let[e,t]=(0,a.useState)([]),[r,y]=(0,a.useState)(!0),[g,_]=(0,a.useState)(!0),[v,j]=(0,a.useState)(null),[N,w]=(0,a.useState)({limit:100}),A=(0,f.Sg)(),[S,T]=(0,a.useState)(null),R=(0,a.useRef)(0),C=(0,a.useCallback)(async()=>{try{let e=await (0,u.V0)(N.limit||100);if(e.success&&e.data){let r=e.data;if(void 0!==N.type){let e=p.x[N.type];r=r.filter(t=>{let r=t.type??t.payload_type,s=t.payload_type_name;return r===N.type||s===e})}if(void 0!==N.route){let e=p.C[N.route];r=r.filter(t=>{let r=t.route??t.route_type,s=t.route_type_name;return r===N.route||s===e})}t(r)}}catch{}finally{y(!1)}},[N]);(0,a.useEffect)(()=>{C()},[C]),(0,x.n)(C,m.v5.packets,g,!0),(0,a.useEffect)(()=>{if(A>0&&A!==R.current&&e.length>0){R.current=A;let t=e.find(e=>(e.payload_type_name||(0,h.wv)(e.payload_type??e.type)).toLowerCase().includes("advert"));if(t){let e=String(t.id??t.packet_hash??""),r=requestAnimationFrame(()=>T(e)),s=setTimeout(()=>T(null),600);return()=>{cancelAnimationFrame(r),clearTimeout(s)}}}},[A,e]);let E=(e,t)=>{y(!0),w(r=>({...r,[e]:t}))};return(0,s.jsxs)("div",{className:"section-gap",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("h1",{className:"type-title text-text-primary flex items-center gap-3",children:[(0,s.jsx)(i.A,{className:"w-6 h-6 text-accent-primary flex-shrink-0"}),"Packet History"]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4",children:[g&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(n.A,{className:"w-2 h-2 fill-accent-success text-accent-success animate-pulse"}),(0,s.jsx)("span",{className:"text-text-muted",children:"Live"})]}),(0,s.jsxs)("button",{onClick:()=>_(!g),className:(0,d.A)("px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg text-sm font-medium transition-all duration-200","flex items-center gap-2 border",g?"bg-accent-success/20 text-accent-success border-accent-success/30":"bg-bg-subtle text-text-muted border-border-subtle hover:bg-bg-elevated"),children:[(0,s.jsx)(o.A,{className:(0,d.A)("w-4 h-4",g&&"animate-spin")}),(0,s.jsx)("span",{className:"hidden xs:inline",children:g?"Live":"Paused"})]})]})]}),(0,s.jsxs)("div",{className:"glass-card p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)(l,{className:"w-5 h-5 text-accent-primary"}),(0,s.jsx)("span",{className:"text-text-primary font-medium",children:"Filters"}),(void 0!==N.type||void 0!==N.route)&&(0,s.jsxs)("button",{onClick:()=>{y(!0),w({limit:100})},className:"ml-auto text-xs text-text-muted hover:text-text-primary flex items-center gap-1",children:[(0,s.jsx)(c.A,{className:"w-3 h-3"})," Clear"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-text-muted mb-1",children:"Packet Type"}),(0,s.jsxs)("select",{value:N.type??"",onChange:e=>E("type",e.target.value?Number(e.target.value):void 0),className:"bg-bg-subtle border border-border-subtle rounded-lg px-3 py-2 text-sm text-text-primary focus:outline-none focus:border-accent-primary/50",children:[(0,s.jsx)("option",{value:"",children:"All Types"}),Object.entries(p.x).map(([e,t])=>(0,s.jsx)("option",{value:e,children:t},e))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-text-muted mb-1",children:"Route Type"}),(0,s.jsxs)("select",{value:N.route??"",onChange:e=>E("route",e.target.value?Number(e.target.value):void 0),className:"bg-bg-subtle border border-border-subtle rounded-lg px-3 py-2 text-sm text-text-primary focus:outline-none focus:border-accent-primary/50",children:[(0,s.jsx)("option",{value:"",children:"All Routes"}),Object.entries(p.C).map(([e,t])=>(0,s.jsx)("option",{value:e,children:t},e))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-text-muted mb-1",children:"Limit"}),(0,s.jsxs)("select",{value:N.limit??100,onChange:e=>E("limit",Number(e.target.value)),className:"bg-bg-subtle border border-border-subtle rounded-lg px-3 py-2 text-sm text-text-primary focus:outline-none focus:border-accent-primary/50",children:[(0,s.jsx)("option",{value:50,children:"50"}),(0,s.jsx)("option",{value:100,children:"100"}),(0,s.jsx)("option",{value:200,children:"200"}),(0,s.jsx)("option",{value:500,children:"500"})]})]})]})]}),(0,s.jsxs)("div",{className:"glass-card overflow-hidden",children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-border-subtle",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4 text-xs font-medium text-text-muted uppercase tracking-wider",children:"Time"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-xs font-medium text-text-muted uppercase tracking-wider",children:"Type"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-xs font-medium text-text-muted uppercase tracking-wider",children:"Route"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-xs font-medium text-text-muted uppercase tracking-wider",children:"RSSI"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-xs font-medium text-text-muted uppercase tracking-wider",children:"SNR"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-xs font-medium text-text-muted uppercase tracking-wider",children:"Length"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-xs font-medium text-text-muted uppercase tracking-wider",children:"Status"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-border-subtle/50",children:r&&0===e.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"text-center py-12 text-text-muted",children:"Loading packets..."})}):0===e.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"text-center py-12 text-text-muted",children:"No packets found"})}):e.map((e,t)=>{let r=e.id??e.packet_hash??String(t),a=(e.payload_type_name||(0,h.wv)(e.payload_type??e.type)).toLowerCase().includes("advert");return(0,s.jsx)(b,{packet:e,index:t,onClick:j,isFlashing:a&&S===r},r)})})]})}),(0,s.jsxs)("div",{className:"px-4 py-3 border-t border-border-subtle text-sm text-text-muted",children:["Showing ",e.length," packets"]})]}),v&&(0,s.jsx)(k,{packet:v,onClose:()=>j(null)})]})}},91958:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(78340).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},94514:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(78340).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])}},e=>{_N_E=e(e.s=56181)}]);